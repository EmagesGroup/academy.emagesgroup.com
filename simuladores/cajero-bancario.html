<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Cajero Bancario Global | EMAGES Academy</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a1a2e;
            --gold: #d4af37;
            --light: #f8f9fa;
            --success: #11998e;
            --danger: #eb3349;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #d4af37 0%, #f4e4bc 100%);
            padding: 25px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            border-bottom: 4px solid var(--primary);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-eg {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gold);
            font-weight: bold;
            font-size: 24px;
            flex-shrink: 0;
        }

        .header-title h1 {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .header-title p {
            font-size: 13px;
            color: var(--primary);
            opacity: 0.8;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .region-selector {
            padding: 10px 15px;
            border: 2px solid var(--primary);
            border-radius: 8px;
            background: white;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
        }

        .lang-btn {
            padding: 8px 16px;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s;
        }

        .lang-btn.active, .lang-btn:hover {
            background: var(--primary);
            color: var(--gold);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            padding: 25px;
            border-right: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
            background: #fff;
        }

        .panel:last-child {
            border-right: none;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--gold);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .student-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--gold);
        }

        .student-card p {
            font-size: 13px;
            margin: 8px 0;
            color: #555;
        }

        .student-card strong {
            color: var(--primary);
        }

        .balance-display {
            background: var(--primary);
            color: var(--gold);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .balance-display h3 {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .balance-display .amount {
            font-size: 32px;
            font-weight: 700;
        }

        .operation-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .op-btn {
            padding: 15px 10px;
            border: none;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: white;
        }

        .op-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .op-btn.deposit { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .op-btn.withdraw { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); }
        .op-btn.transfer { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .op-btn.payment { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .op-btn.check { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: var(--primary); }
        .op-btn.admin { background: linear-gradient(135deg, #333 0%, #555 100%); }

        .input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            display: none;
            margin-bottom: 20px;
        }

        .input-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 12px;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            transition: border-color 0.3s;
            font-family: 'Courier New', monospace;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--gold);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-confirm {
            flex: 1;
            padding: 12px;
            background: var(--gold);
            color: var(--primary);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-confirm:hover {
            background: #b8941f;
        }

        .btn-cancel {
            flex: 1;
            padding: 12px;
            background: #e0e0e0;
            color: #555;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* Denomination Breakdown */
        .breakdown-container {
            background: white;
            border: 2px solid var(--gold);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .breakdown-container.active {
            display: block;
        }

        .breakdown-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .breakdown-item {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .breakdown-item .count {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
            display: block;
        }

        .breakdown-item .label {
            font-size: 10px;
            color: #888;
            display: block;
        }

        /* Statement */
        .statement-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            max-height: 500px;
            overflow-y: auto;
        }

        .statement-header {
            background: var(--primary);
            color: var(--gold);
            padding: 15px;
            font-size: 13px;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .transaction-item {
            display: grid;
            grid-template-columns: 80px 1fr 100px;
            gap: 10px;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 12px;
            align-items: center;
        }

        .transaction-item:hover {
            background: #f8f9fa;
        }

        .transaction-code {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: var(--primary);
        }

        .transaction-amount.positive { color: var(--success); }
        .transaction-amount.negative { color: var(--danger); }

        /* Evaluation */
        .evaluation-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #e0e0e0;
        }

        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--gold);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            margin: 0 auto 15px;
        }

        .footer {
            background: var(--primary);
            color: #888;
            padding: 20px 40px;
            text-align: center;
            font-size: 11px;
        }

        .footer strong {
            color: var(--gold);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--success);
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--danger);
        }

        .code-reference {
            font-size: 10px;
            line-height: 1.6;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            max-height: 300px;
            overflow-y: auto;
        }

        .code-reference strong {
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <div class="logo-eg">EG</div>
                <div class="header-title">
                    <h1 data-lang="simulator_title">Simulador Cajero Bancario Global</h1>
                    <p data-lang="simulator_subtitle">EMAGES Academy | Nivel Agente Internacional</p>
                </div>
            </div>
            <div class="controls">
                <select class="region-selector" id="regionSelector" onchange="changeRegion()">
                    <option value="pe">üáµüá™ Per√∫ (Soles)</option>
                    <option value="af">üåç √Åfrica (D√≥lares)</option>
                    <option value="eu">üá™üá∫ Europa (Euros/D√≥lares)</option>
                </select>
                <div class="language-selector">
                    <button class="lang-btn active" onclick="changeLanguage('es')">ES</button>
                    <button class="lang-btn" onclick="changeLanguage('en')">EN</button>
                    <button class="lang-btn" onclick="changeLanguage('fr')">FR</button>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <!-- PANEL 1: OPERACIONES -->
            <div class="panel">
                <div class="panel-title">
                    <span>üè¶</span>
                    <span data-lang="operations_panel">Operaciones</span>
                </div>

                <div class="student-card">
                    <p><strong data-lang="student_id">ID Estudiante:</strong> <span id="studentId">EMG-2026-001</span></p>
                    <p><strong data-lang="session_time">Tiempo:</strong> <span id="sessionTime">00:00</span></p>
                    <p><strong data-lang="region">Regi√≥n:</strong> <span id="currentRegion">Per√∫</span></p>
                </div>

                <div class="balance-display">
                    <h3 data-lang="available_balance">Saldo Disponible</h3>
                    <div class="amount"><span id="currencySymbol">S/</span> <span id="balance">10000.00</span></div>
                </div>

                <div class="operation-grid">
                    <button class="op-btn deposit" onclick="showOperation('0730')">
                        <span>üí∞</span>
                        <span>0730 - Dep√≥sito</span>
                    </button>
                    <button class="op-btn withdraw" onclick="showOperation('0600')">
                        <span>üíµ</span>
                        <span>0600 - Retiro</span>
                    </button>
                    <button class="op-btn transfer" onclick="showOperation('0740')">
                        <span>üîÑ</span>
                        <span>0740 - Transferencia</span>
                    </button>
                    <button class="op-btn payment" onclick="showOperation('6500')">
                        <span>üìÑ</span>
                        <span>6500 - Pago Servicios</span>
                    </button>
                    <button class="op-btn check" onclick="showOperation('0750')">
                        <span>‚úì</span>
                        <span>0750 - Cheque Local</span>
                    </button>
                    <button class="op-btn admin" onclick="showOperation('1010')">
                        <span>üîß</span>
                        <span>1010 - Provisi√≥n</span>
                    </button>
                    <button class="op-btn admin" onclick="showOperation('4008')">
                        <span>üè¶</span>
                        <span>4008 - Transf. B√≥veda</span>
                    </button>
                    <button class="op-btn admin" onclick="showOperation('3043')">
                        <span>üìä</span>
                        <span>3043 - Cuadre Efectivo</span>
                    </button>
                </div>

                <!-- Input Sections -->
                <div class="input-section" id="operationSection">
                    <h4 id="operationTitle">Realizar Operaci√≥n</h4>
                    
                    <div class="input-group">
                        <label data-lang="operation_code_input">C√≥digo de Operaci√≥n</label>
                        <input type="text" id="opCodeInput" placeholder="Ej: 0730" maxlength="4">
                    </div>

                    <div class="input-group">
                        <label data-lang="amount_label">Monto</label>
                        <input type="number" id="opAmount" placeholder="0.00" min="0.01" step="0.01" oninput="calculateBreakdown()">
                    </div>

                    <div class="input-group" id="accountGroup">
                        <label data-lang="account_number_input">N√∫mero de Cuenta</label>
                        <input type="text" id="opAccount" placeholder="000-0000000-00">
                    </div>

                    <!-- Denomination Breakdown Display -->
                    <div class="breakdown-container" id="breakdownContainer">
                        <div class="breakdown-title" data-lang="bill_breakdown">Desglose de Billetes/Monedas</div>
                        <div class="breakdown-grid" id="breakdownGrid">
                            <!-- Dynamic Content -->
                        </div>
                        <p style="font-size: 10px; color: #888; margin-top: 10px; text-align: center;">
                            * Verifique f√≠sicamente esta cantidad antes de confirmar
                        </p>
                    </div>

                    <div class="action-buttons">
                        <button class="btn-confirm" onclick="executeOperation()" data-lang="confirm">Confirmar</button>
                        <button class="btn-cancel" onclick="hideOperations()" data-lang="cancel">Cancelar</button>
                    </div>
                </div>

                <div class="evaluation-panel">
                    <h4 data-lang="evaluation_title">Evaluaci√≥n Autom√°tica</h4>
                    <div class="score-circle" id="scoreCircle">0%</div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; margin-top: 10px;">
                        <span data-lang="accuracy">Precisi√≥n:</span>
                        <span id="accuracyScore">0/0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; margin-top: 5px;">
                        <span data-lang="codes_correct">C√≥digos:</span>
                        <span id="codesScore">0/0</span>
                    </div>
                </div>
            </div>

            <!-- PANEL 2: EXTRACTO -->
            <div class="panel">
                <div class="panel-title">
                    <span>üìã</span>
                    <span data-lang="statement_panel">Extracto de Cuenta</span>
                </div>

                <div class="statement-container" id="statementContainer">
                    <div class="statement-header">
                        <div style="display: grid; grid-template-columns: 80px 1fr 100px; gap: 10px;">
                            <span data-lang="col_code">C√ìDIGO</span>
                            <span data-lang="col_description">DESCRIPCI√ìN</span>
                            <span data-lang="col_amount" style="text-align: right;">MONTO</span>
                        </div>
                    </div>
                    <div id="transactionList">
                        <div class="transaction-item">
                            <div class="transaction-code">1010</div>
                            <div class="transaction-desc" data-lang="initial_balance">Provisi√≥n Inicial</div>
                            <div class="transaction-amount positive"><span id="initCurrency">S/</span> 10,000.00</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PANEL 3: REFERENCIAS -->
            <div class="panel">
                <div class="panel-title">
                    <span>üìö</span>
                    <span data-lang="reference_panel">C√≥digos de Referencia</span>
                </div>

                <div class="code-reference">
                    <strong>1000 - APERTURA/CIERRE</strong><br>
                    1010: Provisi√≥n Inicial<br>
                    1012: Aumento Efectivo<br>
                    1014: Disminuci√≥n Efectivo<br>
                    101: Cierre de Caja<br>
                    3069: Cierre de Agencia<br>
                    <br>
                    <strong>0600/0700 - TRANSACCIONES</strong><br>
                    0600: Retiro Efectivo Ahorro<br>
                    0730: Dep√≥sito Efectivo<br>
                    0740: Transferencia Cuentas<br>
                    0750: Cheque M/B Local<br>
                    0732: Cheque Otro Banco<br>
                    <br>
                    <strong>6000/7000 - SERVICIOS</strong><br>
                    6500: Pago de Servicios<br>
                    7019: Reversi√≥n Movimientos<br>
                    7190: Pago Otros Egresos<br>
                    7290: Cobro Otros Ingresos<br>
                    <br>
                    <strong>3000/4000 - REPORTES</strong><br>
                    3043: Cuadre Efectivo<br>
                    3047: Mov. Contables<br>
                    4000: Balance Movimientos<br>
                    4008: Transf. Caja-B√≥veda<br>
                    <br>
                    <strong>0100 - CONSULTAS</strong><br>
                    0100: Consulta Movimientos<br>
                    0102: Consulta Saldos<br>
                    0810: Compra M.E.<br>
                    0812: Venta M.E.
                </div>

                <div class="student-card" style="margin-top: 20px;">
                    <p><strong data-lang="denominations_title">Denominaciones Activas</strong></p>
                    <div id="activeDenominations" style="font-size: 11px; margin-top: 5px;">
                        <!-- Dynamic -->
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>EMAGESGROUP E.I.R.L. ‚Äì RUC 20611427671</strong></p>
            <p data-lang="footer_text">Simulador educativo con fines de capacitaci√≥n. No representa operaciones bancarias reales.</p>
            <p data-lang="legal_notice">¬© 2026 EMAGES Academy. Todos los derechos reservados.</p>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // State Management
        let state = {
            balance: 10000.00,
            transactions: [],
            operations: 0,
            errors: 0,
            correctOperations: 0,
            correctCodes: 0,
            totalCodes: 0,
            startTime: new Date(),
            language: 'es',
            region: 'pe',
            currentOpCode: null
        };

        // Configuration by Region
        const regions = {
            pe: {
                name: 'Per√∫',
                currency: 'S/',
                denominations: [200, 100, 50, 20, 10, 5, 2, 1, 0.5, 0.2, 0.1]
            },
            af: {
                name: '√Åfrica',
                currency: '$',
                denominations: [100, 50, 20, 10, 5, 1] // USD standard
            },
            eu: {
                name: 'Europa',
                currency: '‚Ç¨',
                denominations: [500, 200, 100, 50, 20, 10, 5, 2, 1, 0.5, 0.2, 0.1] // EUR standard
            }
        };

        // Operation Codes Database (Merged from PDF & SARABANK)
        const operationCodes = {
            '1010': 'Provisi√≥n Inicial',
            '1012': 'Aumento de Efectivo',
            '1014': 'Disminuci√≥n de Efectivo',
            '101': 'Cierre de Caja',
            '3043': 'Cuadre de Efectivo',
            '3047': 'Movimientos Contables',
            '3050': 'Env√≠o Asientos',
            '3051': 'Integraci√≥n Contable',
            '3069': 'Cierre de Agencia',
            '3500': 'Cuadre Contable',
            '4000': 'Balance Movimientos',
            '4008': 'Transf. Caja-B√≥veda',
            '4373': 'Aumento desde Caja',
            '5102': 'Pago de Pr√©stamos',
            '7001': 'Cambio Denominaciones',
            '7019': 'Reversi√≥n Movimientos',
            '7190': 'Pago Otros Egresos',
            '7290': 'Cobro Otros Ingresos',
            '9564': 'Reimpresi√≥n Comprobantes',
            '0600': 'Retiro Efectivo Ahorro',
            '0730': 'Dep√≥sito en Efectivo',
            '0740': 'Transferencia Cuentas',
            '6500': 'Pago de Servicios',
            '0750': 'Cheque M/B Local',
            '0732': 'Cheque Otro Banco',
            '0100': 'Consulta Movimientos',
            '0102': 'Consulta Saldos',
            '0810': 'Compra M.E.',
            '0812': 'Venta M.E.',
            '1106': 'Retiro Ahorros (PDF)',
            '1209': 'Dep√≥sito Ahorros (PDF)'
        };

        // Translations
        const translations = {
            es: {
                simulator_title: 'Simulador Cajero Bancario Global',
                simulator_subtitle: 'EMAGES Academy | Nivel Agente Internacional',
                operations_panel: 'Operaciones',
                student_id: 'ID Estudiante:',
                session_time: 'Tiempo:',
                region: 'Regi√≥n:',
                available_balance: 'Saldo Disponible',
                operation_code_input: 'C√≥digo de Operaci√≥n',
                amount_label: 'Monto',
                account_number_input: 'N√∫mero de Cuenta',
                bill_breakdown: 'Desglose de Billetes/Monedas',
                confirm: 'Confirmar',
                cancel: 'Cancelar',
                evaluation_title: 'Evaluaci√≥n Autom√°tica',
                accuracy: 'Precisi√≥n',
                codes_correct: 'C√≥digos',
                statement_panel: 'Extracto de Cuenta',
                col_code: 'C√ìDIGO',
                col_description: 'DESCRIPCI√ìN',
                col_amount: 'MONTO',
                initial_balance: 'Provisi√≥n Inicial',
                reference_panel: 'C√≥digos de Referencia',
                denominations_title: 'Denominaciones Activas',
                footer_text: 'Simulador educativo con fines de capacitaci√≥n. No representa operaciones bancarias reales.',
                legal_notice: '¬© 2026 EMAGES Academy. Todos los derechos reservados.',
                notification_success: 'Operaci√≥n realizada exitosamente',
                notification_error: 'Error: C√≥digo o monto inv√°lido',
                notification_code_error: 'Error: C√≥digo de operaci√≥n incorrecto'
            },
            en: {
                simulator_title: 'Global Bank Teller Simulator',
                simulator_subtitle: 'EMAGES Academy | International Agent Level',
                operations_panel: 'Operations',
                student_id: 'Student ID:',
                session_time: 'Time:',
                region: 'Region:',
                available_balance: 'Available Balance',
                operation_code_input: 'Operation Code',
                amount_label: 'Amount',
                account_number_input: 'Account Number',
                bill_breakdown: 'Bill/Coin Breakdown',
                confirm: 'Confirm',
                cancel: 'Cancel',
                evaluation_title: 'Automatic Evaluation',
                accuracy: 'Accuracy',
                codes_correct: 'Codes',
                statement_panel: 'Account Statement',
                col_code: 'CODE',
                col_description: 'DESCRIPTION',
                col_amount: 'AMOUNT',
                initial_balance: 'Initial Provision',
                reference_panel: 'Reference Codes',
                denominations_title: 'Active Denominations',
                footer_text: 'Educational simulator for training purposes. Does not represent real banking operations.',
                legal_notice: '¬© 2026 EMAGES Academy. All rights reserved.',
                notification_success: 'Operation completed successfully',
                notification_error: 'Error: Invalid code or amount',
                notification_code_error: 'Error: Incorrect operation code'
            },
            fr: {
                simulator_title: 'Simulateur de Guichetier Global',
                simulator_subtitle: 'EMAGES Academy | Niveau Agent International',
                operations_panel: 'Op√©rations',
                student_id: 'ID √âtudiant:',
                session_time: 'Temps:',
                region: 'R√©gion:',
                available_balance: 'Solde Disponible',
                operation_code_input: 'Code d\'Op√©ration',
                amount_label: 'Montant',
                account_number_input: 'Num√©ro de Compte',
                bill_breakdown: 'D√©tail Billets/Pi√®ces',
                confirm: 'Confirmer',
                cancel: 'Annuler',
                evaluation_title: '√âvaluation Automatique',
                accuracy: 'Pr√©cision',
                codes_correct: 'Codes',
                statement_panel: 'Relev√© de Compte',
                col_code: 'CODE',
                col_description: 'DESCRIPTION',
                col_amount: 'MONTANT',
                initial_balance: 'Provision Initiale',
                reference_panel: 'Codes de R√©f√©rence',
                denominations_title: 'Denominations Actives',
                footer_text: 'Simulateur √©ducatif √† des fins de formation. Ne repr√©sente pas des op√©rations bancaires r√©elles.',
                legal_notice: '¬© 2026 EMAGES Academy. Tous droits r√©serv√©s.',
                notification_success: 'Op√©ration effectu√©e avec succ√®s',
                notification_error: 'Erreur: Code ou montant invalide',
                notification_code_error: 'Erreur: Code d\'op√©ration incorrect'
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            startSessionTimer();
            updateEvaluation();
            changeRegion(); // Initialize denominations
        });

        // Region Change
        function changeRegion() {
            const region = document.getElementById('regionSelector').value;
            state.region = region;
            const config = regions[region];
            
            document.getElementById('currentRegion').textContent = config.name;
            document.getElementById('currencySymbol').textContent = config.currency;
            document.getElementById('initCurrency').textContent = config.currency;
            
            // Update Balance Display
            updateBalance();

            // Show Active Denominations
            const denomList = document.getElementById('activeDenominations');
            denomList.innerHTML = config.denominations.map(d => 
                `<span style="display:inline-block; background:#e0e0e0; padding:2px 6px; border-radius:4px; margin:2px;">${config.currency} ${d}</span>`
            ).join('');

            // Recalculate breakdown if amount exists
            const amount = document.getElementById('opAmount').value;
            if(amount) calculateBreakdown();
        }

        // Language Switcher
        function changeLanguage(lang) {
            state.language = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('[data-lang]').forEach(element => {
                const key = element.getAttribute('data-lang');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
        }

        // Session Timer
        function startSessionTimer() {
            setInterval(() => {
                const elapsed = Math.floor((new Date() - state.startTime) / 1000);
                const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const seconds = (elapsed % 60).toString().padStart(2, '0');
                document.getElementById('sessionTime').textContent = `${minutes}:${seconds}`;
            }, 1000);
        }

        // Show Operation Section
        function showOperation(code) {
            document.getElementById('operationSection').classList.add('active');
            document.getElementById('opCodeInput').value = code;
            document.getElementById('operationTitle').textContent = `${code} - ${operationCodes[code] || 'Operaci√≥n'}`;
            state.currentOpCode = code;
            
            // Show/Hide Account Field based on operation type
            const accountGroup = document.getElementById('accountGroup');
            if(['0740', '0730', '0750', '0732', '1209'].includes(code)) {
                accountGroup.style.display = 'block';
            } else {
                accountGroup.style.display = 'none';
            }

            document.getElementById('opAmount').value = '';
            document.getElementById('breakdownContainer').classList.remove('active');
        }

        // Hide Operations
        function hideOperations() {
            document.getElementById('operationSection').classList.remove('active');
            state.currentOpCode = null;
        }

        // Calculate Denomination Breakdown
        function calculateBreakdown() {
            const amount = parseFloat(document.getElementById('opAmount').value);
            const container = document.getElementById('breakdownContainer');
            const grid = document.getElementById('breakdownGrid');
            
            if (!amount || amount <= 0) {
                container.classList.remove('active');
                return;
            }

            container.classList.add('active');
            const config = regions[state.region];
            let remaining = amount;
            let breakdown = {};

            // Greedy Algorithm for Breakdown
            config.denominations.forEach(denom => {
                if (remaining >= denom) {
                    const count = Math.floor(remaining / denom);
                    breakdown[denom] = count;
                    remaining = parseFloat((remaining - (count * denom)).toFixed(2));
                }
            });

            // Render Breakdown
            grid.innerHTML = Object.keys(breakdown).map(denom => `
                <div class="breakdown-item">
                    <span class="count">${breakdown[denom]}</span>
                    <span class="label">${config.currency} ${denom}</span>
                </div>
            `).join('');

            if (remaining > 0.001) {
                grid.innerHTML += `<div style="grid-column: 1/-1; text-align:center; color: var(--danger); font-size:10px;">‚ö†Ô∏è Sin denominaci√≥n para ${config.currency} ${remaining}</div>`;
            }
        }

        // Execute Operation
        function executeOperation() {
            const enteredCode = document.getElementById('opCodeInput').value.trim();
            const amount = parseFloat(document.getElementById('opAmount').value);
            
            state.totalCodes++;

            // Validate Code
            if (enteredCode !== state.currentOpCode || !operationCodes[enteredCode]) {
                showNotification(translations[state.language].notification_code_error, true);
                state.errors++;
                updateEvaluation();
                return;
            }

            state.correctCodes++;

            // Validate Amount & Balance
            if (!amount || amount <= 0) {
                showNotification(translations[state.language].notification_error, true);
                state.errors++;
                updateEvaluation();
                return;
            }

            // Process Transaction
            let type = 'neutral';
            let sign = 'positive';
            
            // Simple logic for demo (Withdrawals decrease balance, Deposits increase)
            if(['0600', '1014', '6500', '4008'].includes(enteredCode)) {
                if(amount > state.balance) {
                    showNotification('Saldo insuficiente', true);
                    state.errors++;
                    return;
                }
                state.balance -= amount;
                sign = 'negative';
            } else if(['0730', '1010', '1012', '0750'].includes(enteredCode)) {
                state.balance += amount;
                sign = 'positive';
            }

            state.correctOperations++;
            state.operations++;
            
            addTransaction(enteredCode, operationCodes[enteredCode], amount, sign);
            updateBalance();
            hideOperations();
            updateEvaluation();
            showNotification(translations[state.language].notification_success);
        }

        // Update Balance Display
        function updateBalance() {
            document.getElementById('balance').textContent = state.balance.toFixed(2);
        }

        // Add Transaction to Statement
        function addTransaction(code, description, amount, sign) {
            const transactionList = document.getElementById('transactionList');
            const item = document.createElement('div');
            item.className = 'transaction-item';
            item.innerHTML = `
                <div class="transaction-code">${code}</div>
                <div class="transaction-desc">${description}</div>
                <div class="transaction-amount ${sign}">${regions[state.region].currency} ${amount.toFixed(2)}</div>
            `;
            transactionList.insertBefore(item, transactionList.firstChild.nextSibling);
        }

        // Update Evaluation
        function updateEvaluation() {
            const totalOps = state.operations + state.errors;
            const accuracy = totalOps > 0 ? Math.round((state.correctOperations / totalOps) * 100) : 0;
            const codeAccuracy = state.totalCodes > 0 ? Math.round((state.correctCodes / state.totalCodes) * 100) : 0;
            
            document.getElementById('scoreCircle').textContent = `${accuracy}%`;
            document.getElementById('accuracyScore').textContent = `${state.correctOperations}/${totalOps}`;
            document.getElementById('codesScore').textContent = `${state.correctCodes}/${state.totalCodes}`;
        }

        // Show Notification
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = isError ? 'notification error show' : 'notification show';
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
